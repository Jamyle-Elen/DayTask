{% load static %}
<div class="bg-white rounded-xl shadow divide-y divide-gray-200 overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-300">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide"></th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Nome</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Sexo</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Idade</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">Email</th>
        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wide">Ações</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200 bg-white">
      {% for user in users %}
      <tr>
        <!-- Ícone sexo -->
        <td class="px-6 py-4 whitespace-nowrap text-center justify-center">
    {% if user.is_superuser %}
        <img width="40" class="rounded-full mx-auto" src="{% static 'images/photo_profile_admin.avif' %}" alt="Admin">
    {% elif user.sex == 'M' %}
      <img width="40" class="mx-auto" src="{% static 'images/photo_profile_male.png' %}" alt="Masculino" class="mx-auto" />
    {% elif user.sex == 'F' %}
      <img width="40" class="mx-auto" src="{% static 'images/photo_profile_female.png' %}" alt="Feminino" class="mx-auto" />
    {% else %}
      <span class="text-gray-400">–</span>
    {% endif %}
  </td>


        <!-- Nome -->
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.name }}</td>

        <!-- Sexo texto -->
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          {% if user.sex == 'M' %}Masculino{% elif user.sex == 'F' %}Feminino{% else %}Outro{% endif %}
        </td>

        <!-- Idade -->
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
        {% if user.age %}
            {{ user.age }}
        {% else %}
            N/A
        {% endif %}
        </td>

        <!-- Email -->
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ user.email }}</td>

        <!-- Ações -->
        <td class="flex items-center justify-center align-center px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-4">
          <!-- Detalhes -->
          <a href="#" class="text-gray-900 hover:text-indigo-900" title="Detalhes">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-1 inline h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 16v-4m0-4h.01" />
            </svg>
          </a>

          <!-- Editar -->
          <a href="#" class="text-green-600 hover:text-green-900" title="Editar">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-black hover:text-gray-700"
                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
          </a>

          <!-- Apagar -->
          <a href="#" class="text-red-600 hover:text-red-900" title="Apagar" onclick="return confirm('Confirma exclusão?')">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-black hover:text-gray-700"
                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4m-4 0a1 1 0 00-1 1v1h6V4a1 1 0 00-1-1m-4 0h4" />
                        </svg>
          </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="px-6 py-4 text-center text-gray-500">Nenhum usuário encontrado.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Paginação simples -->
  <div class="flex justify-end p-4">
    {% if has_next %}
    <a href="?page={{ page|add:1 }}" class="px-4 py-2 bg-pink-500 text-white rounded hover:bg-pink-600 transition">Ver mais</a>
    {% endif %}
  </div>
</div>


<!-- AG GRID -->
<div id="myGrid" class="ag-theme-alpine"></div>

  <script>
    const columnDefs = [
      {
        headerName: "Sexo",
        field: "sex",
        width: 100,
        cellRenderer: params => {
          if(params.value === 'M'){
            return '<img src="{% static "images/photo_profile_male.png" %}" width="30" alt="M">';
          }
          if(params.value === 'F'){
            return '<img src="{% static "images/photo_profile_female.png" %}" width="30" alt="F">';
          }
          return params.value;
        }
      },
      { headerName: "Nome", field: "name", editable: true, filter: 'agTextColumnFilter' },
      { headerName: "Idade", field: "age", filter: 'agNumberColumnFilter' },
      { headerName: "Email", field: "email", editable: true },
    ];


    const gridOptions = {
      columnDefs: columnDefs,
      rowData: rowData,
      pagination: true,
      paginationPageSize: 10,
      defaultColDef: {
        sortable: true,
        filter: true,
        resizable: true,
      },
      onCellValueChanged: event => {
        console.log('Cell value changed', event);
        // Aqui você pode fazer um fetch para salvar alteração no backend via API
      }
    };

    const eGridDiv = document.querySelector('#myGrid');
    new agGrid.Grid(eGridDiv, gridOptions);
  </script>
